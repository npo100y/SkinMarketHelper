<UserControl x:Class="SkinMarketHelper.Views.ProfileView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             d:DesignHeight="500" d:DesignWidth="800">
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Информация о пользователе -->
        <Border Grid.Row="0"
                Background="#FF2D2D2D"
                Padding="10"
                CornerRadius="5"
                Margin="0,0,0,10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="2*"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0">
                    <TextBlock Text="Личный кабинет"
                               Foreground="White"
                               FontSize="16"
                               FontWeight="Bold"/>
                    <TextBlock Text="{Binding CurrentUser.Username, StringFormat='Пользователь: {0}'}"
                               Foreground="White"
                               Margin="0,5,0,0"/>
                    <TextBlock Text="{Binding CurrentUser.Role, StringFormat='Роль: {0}'}"
                               Foreground="LightGray"/>
                    <TextBlock Text="{Binding CurrentUser.SteamId64, StringFormat='SteamID64: {0}'}"
                               Foreground="LightGray"/>
                    <TextBlock Text="{Binding CurrentUser.Balance, StringFormat='Баланс: {0:F2} ₽'}"
                               Foreground="LightGreen"
                               FontSize="14"
                               Margin="0,5,0,0"/>
                </StackPanel>

                <StackPanel Grid.Column="1"
                    HorizontalAlignment="Right">
                    <TextBlock Text="Пополнение баланса"
                        Foreground="White"
                        FontWeight="Bold"
                        Margin="0,0,0,5"
                        HorizontalAlignment="Right"/>
                    <StackPanel Orientation="Horizontal"
                        HorizontalAlignment="Right"
                        Margin="0,0,0,5">
                        <TextBox Text="{Binding TopUpAmountText, UpdateSourceTrigger=PropertyChanged}"
                            Width="100"
                            Height="24"
                            Margin="0,0,5,0"/>
                        <Button Content="Пополнить"
                            Command="{Binding TopUpCommand}"
                            Width="90"
                            Height="24"/>
                    </StackPanel>

                    <TextBlock Text="Вывод средств"
                        Foreground="White"
                        FontWeight="Bold"
                        Margin="0,5,0,5"
                        HorizontalAlignment="Right"/>
                    <StackPanel Orientation="Horizontal"
                        HorizontalAlignment="Right">
                        <TextBox Text="{Binding WithdrawAmountText, UpdateSourceTrigger=PropertyChanged}"
                            Width="100"
                            Height="24"
                            Margin="0,0,5,0"/>
                        <Button Content="Вывести"
                            Command="{Binding WithdrawCommand}"
                            Width="90"
                            Height="24"/>
                    </StackPanel>
                </StackPanel>
            </Grid>
        </Border>

        <!-- История операций -->
        <Border Grid.Row="1"
                Background="#FF252525"
                CornerRadius="5"
                Padding="10">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <DockPanel Grid.Row="0" Margin="0,0,0,5" LastChildFill="False">
                    <TextBlock Text="История операций"
                               Foreground="White"
                               FontSize="14"
                               FontWeight="Bold"
                               DockPanel.Dock="Left"/>

                    <Button Content="Обновить"
                            Command="{Binding RefreshCommand}"
                            Width="90"
                            Height="24"
                            DockPanel.Dock="Right"/>
                </DockPanel>

                <DataGrid Grid.Row="1"
                    ItemsSource="{Binding BalanceOperations}"
                    AutoGenerateColumns="False"
                    HeadersVisibility="Column"
                    CanUserAddRows="False"
                    CanUserDeleteRows="False"
                    IsReadOnly="True"
                    Background="#FF252525"
                    Foreground="White"
                    RowBackground="#FF333333"
                    AlternatingRowBackground="#FF3B3B3B"
                    GridLinesVisibility="Horizontal"
                    HorizontalGridLinesBrush="#FF444444">

                    <DataGrid.ColumnHeaderStyle>
                        <Style TargetType="DataGridColumnHeader">
                            <Setter Property="Background" Value="#FF3A3A3A"/>
                            <Setter Property="Foreground" Value="White"/>
                            <Setter Property="FontWeight" Value="Bold"/>
                        </Style>
                    </DataGrid.ColumnHeaderStyle>

                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Дата"
                                            Binding="{Binding CreatedAt, StringFormat={}{0:g}}"
                                            Width="150" />
                        <DataGridTextColumn Header="Тип"
                                            Binding="{Binding Type}"
                                            Width="100" />
                        <DataGridTextColumn Header="Сумма"
                                            Binding="{Binding Amount, StringFormat={}{0:F2} ₽}"
                                            Width="100" />
                        <DataGridTextColumn Header="Описание"
                                            Binding="{Binding Description}"
                                            Width="*" />
                    </DataGrid.Columns>
                </DataGrid>
            </Grid>
        </Border>

        <!-- Нижняя панель: отчёт и статус -->
        <StackPanel Grid.Row="2"
                    Orientation="Vertical"
                    Margin="0,10,0,0">
            <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                <Button Content="Сформировать отчёт"
                    Command="{Binding ExportReportCommand}"
                    Width="150" 
                    Height="26"/>
            </StackPanel>

            <Border Background="#FF303030"
                    CornerRadius="3"
                    Padding="5">
                <TextBlock Text="{Binding StatusMessage}"
                           Foreground="White"/>
            </Border>
        </StackPanel>
    </Grid>
</UserControl>
